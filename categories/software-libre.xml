<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/"><channel><title>JáquerEspeis (Publicaciones sobre Software libre)</title><link>http://www.jaquerespeis.org/</link><description></description><atom:link type="application/rss+xml" href="http://www.jaquerespeis.org/categories/software-libre.xml" rel="self"></atom:link><language>es</language><lastBuildDate>Tue, 08 Aug 2017 20:05:34 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Instaladores de Firma Digital de Costa Rica para GNU/Linux</title><link>http://www.jaquerespeis.org/posts/instaladores-de-firma-digital-de-costa-rica-para-gnu-linux/</link><dc:creator>JáquerEspeis</dc:creator><description>&lt;p&gt;Este proyecto de instaladores se ha creado en conjunto con &lt;a href="https://solvosoft.com/" target="_blank"&gt;Luis Zárate&lt;/a&gt; para facilitar la instalación de las herramientas necesarias de Firma Digital de Costa Rica en distribuciones GNU/Linux. Se trata de un desarrollo no oficial, creado voluntariamente para mejorar el soporte en diversas distribuciones este sistema operativo, inicialmente para Debian y Ubuntu y próximamente para Fedora, CentOS, openSUSE y Arch.&lt;/p&gt;
&lt;p&gt;El mecanismo para instalar los instaladores se realiza mediante un repositorio. Esto permite facilitar la instalación de los paquetes y poder recibir actualizaciones de los mismos de la misma manera que el resto de software del sistema.&lt;/p&gt;
&lt;p&gt;Los instaladores configuran el sistema para agregar confianza a los certificados de la jerarquía nacional en los diferentes programas que hacen uso de almacenes de certificados (NSS de Mozilla, OpenSSL, GnuTLS y Java), así como el controlador del lector de tarjetas y también el módulo para poder manejar la tarjeta de Firma Digital.&lt;/p&gt;
&lt;p&gt;Basados en parte en las guías previas con diversas mejoras, se ha verificado que tras la instalación del paquete se pueden utilizar servicios de Firma Digital y se listan las autoridades de certificados de la jerarquía nacional en software como Mozilla Firefox, Mozilla Thunderbird, Chromium/Chrome, Evolution, Seahorse (contraseñas y claves) y aplicaciones Java.&lt;/p&gt;
&lt;p&gt;Las instrucciones de instalación están disponibles en el sitio web &lt;a href="http://repos.solvosoft.com/" target="_blank"&gt;repos.solvosoft.com&lt;/a&gt;.&lt;/p&gt;</description><category>Firma digital</category><category>Software libre</category><guid>http://www.jaquerespeis.org/posts/instaladores-de-firma-digital-de-costa-rica-para-gnu-linux/</guid><pubDate>Sun, 25 Dec 2016 05:12:45 GMT</pubDate></item><item><title>Soluciones modernas para usar firma digital desde la web</title><link>http://www.jaquerespeis.org/posts/soluciones-modernas-para-usar-firma-digital-desde-la-web/</link><dc:creator>JáquerEspeis</dc:creator><description>&lt;p&gt;En el mundo de los estándares web no ha habido ni hay (por ahora) un mecanismo que permita acceder a dispositivos de seguridad para poder firmar digitalmente. Mientras avanzan los &lt;a href="https://w3c.github.io/webcrypto/KeyDiscovery.html"&gt;esfuerzos&lt;/a&gt; en este sentido y con cierto retraso, en estos años han existido diversas formas no estándar para poder firmar, siendo todas ellas soluciones propietarias de cada navegador o bien utilizando tecnologías de complementos. Una de las más extendidas por su portabilidad era un firmador en Java utilizando applets, pero esta tecnología se está eliminando de los navegadores modernos y también siendo eliminada en futuras versiones de Java.&lt;/p&gt;
&lt;p&gt;En la actualidad hay navegadores modernos como Edge que no disponen de ninguna forma de agregar complementos que permitan ejecutar código privilegiado y hasta la fecha &lt;a href="https://wpdev.uservoice.com/forums/257854-microsoft-edge-developer/suggestions/13612338-native-messaging"&gt;no hay planes todavía&lt;/a&gt; para ello. Estos cambios fuerzan a utilizar formas más ingeniosas para resolver este problema de falta de interacción de sistemas de firma digital con los nuevos navegadores.&lt;/p&gt;
&lt;p&gt;Afortunadamente existe una posible solución para comunicar sitios web con el hardware sin necesidad de complementos especiales en el navegador. La empresa que desarrolla y mantiene el proyecto DSS utiliza una técnica sencilla pero eficaz, mediante una aplicación de escritorio que ejecuta un servicio escuchando en un puerto en particular que tiene privilegios para acceder a los dispositivos de firma digital, los sitios web pueden comunicarse con este servicio local y enviarle la información que debe ser firmada y el resto del proceso se realiza en el lado de la web. Una de las aplicaciones existentes que utilizan esta técnica es software libre y se llama NexU, el cual se ha integrado en DSS a partir de la reciente versión 4.7.0, la cual ha decidido utlilizarla como reemplazo a los obsolescentes applets y JNLP.&lt;/p&gt;
&lt;h2&gt;Demostración de firma sin complementos de navegador&lt;/h2&gt;
&lt;p&gt;En el momento de escribir esto, he encontrado en línea una &lt;a href="http://dss.agid.gov.it/nexu"&gt;instalación de la WebApp de DSS 4.7&lt;/a&gt; para poder probar NexU, que una vez descargado hay que ejecutar el jar que contiene el zip y recargar la página de la webapp, que detectará que se está ejecutando y el botón de formulario &lt;code&gt;Install NexU&lt;/code&gt; cambiará a &lt;code&gt;Submit&lt;/code&gt;. Para ejecutar el jar en GNU/Linux hay que tener instalado OpenJFX, que se explica en una entrada de blog previa. Para probarlo se puede desde una terminal mediante &lt;code&gt;java -jar nexu.jar&lt;/code&gt; y manteniendo la terminal abierta. Para verificar que el servicio está ejecutándose correctamente se puede ingresar en el navegador en el sitio &lt;code&gt;http://localhost:9776/nexu-info&lt;/code&gt;, donde debería aparecer un pequeño objeto JSON con la versión de la aplicación.&lt;/p&gt;
&lt;h3&gt;El problema del contenido mixto&lt;/h3&gt;
&lt;p&gt;El sitio web enlazado podría funcionar con HTTPS y el servicio local con HTTP, por lo que los navegadores modernos suelen bloquear esta comunicación. En Chromium aparece el icono de un escudo en la parte derecha de la barra de direcciones, donde haciendo clic se puede permitir la carga insegura y en Firefox aparece un candado verde con un triángulo gris con una exclamación, donde haciendo clic y a continuación en la parte derecha donde aparece un símbolo “&amp;gt;” se puede deshabilitar la carga insegura y finalmente el sitio web podrá acceder al servicio local.&lt;/p&gt;
&lt;p&gt;A partir de las versiones 1.6.x de NexU se soporta HTTPS, una solución a este problema sería modificar la WebApp de DSS para que conecte a local por HTTPS y que exista un certificado para un host local, confiado e instalado en la máquina para que permita el acceso seguro a localhost y evitar el inconveniente del contenido mixto. La versión de NexU que sugiere DSS de momento es la 1.3, que no soporta HTTPS, por lo que debe descargarse la 1.6.2 o la 1.7 aparte y hacer los ajustes necesarios a DSS. En cualquier caso si bien la confianza SSL a localhost &lt;a href="https://cabforum.org/pipermail/public/2015-June/005673.html"&gt;no se puede realizar con autoridades de certificación públicas&lt;/a&gt;, disponer de un nombre de host apuntando a 127.0.0.1 con una CA autofirmada, creada en la propia máquina, instalada y confiada y con ella firmando un certificado (para luego desechar la clave privada de la CA por seguridad) evita este problema. Otra opción sería usar un servidor seguro intermedio que se comunique con la aplicación de escritorio y el sitio web por backend, aunque esta opción también es relativamente compleja y requiere configuración a una dirección específica que haga conexión permanente desde la aplicación que accede a la tarjeta y mantener la comunicación abierta mientras esté el firmador en ejecución, pero esta solución requiere infraestructura adicional y la misma herramienta se alejaría de ser multipropósito sin previa actualización de la configuración.&lt;/p&gt;
&lt;h2&gt;Escenario ideal&lt;/h2&gt;
&lt;p&gt;Si bien esta solución es relativamente nueva y requiere algunos ajustes de configuración y previamente instalar la herramienta de acceso a la tarjeta, se perfila como una solución viable para poder realizar firma digital en la web de manera interoperable y multiplataforma. La posibilidad de que existieran actualizaciones a los instaladores de Firma Digital actuales del país contemplando la preinstalación de una herramienta de este estilo abriría la posibilidad de poder integrar esta solución en sistemas Windows, GNU/Linux y macOS y de que las instituciones adoptaran este mecanismo para solucionar el problema con los navegadores modernos.&lt;/p&gt;</description><category>Firma digital</category><category>Software libre</category><guid>http://www.jaquerespeis.org/posts/soluciones-modernas-para-usar-firma-digital-desde-la-web/</guid><pubDate>Thu, 10 Nov 2016 00:11:09 GMT</pubDate></item><item><title>Cómo firmar documentos PDF con firma digital de Costa Rica con software libre</title><link>http://www.jaquerespeis.org/posts/como-firmar-documentos-pdf-con-firma-digital-de-costa-rica-con-software-libre/</link><dc:creator>JáquerEspeis</dc:creator><description>&lt;p&gt;La &lt;a href="http://www.mifirmadigital.go.cr/wp-content/uploads/2016/03/DCFD-Poli%CC%81tica-de-Formato-Oficial-v1.0.pdf"&gt;Política de Formatos Oficiales de los Documentos Electrónicos Firmados Digitalmente&lt;/a&gt; de Costa Rica especifica el tipo de documentos y su formato de firma digital. En el caso de PDF se utiliza un estándar especificado en Europa para firma digital avanzada (AdES) y en el caso de los PDF se llama PAdES. En el documento oficial enlazado previamente se muestra que tiene que soportar PAdES-LTV (permite la validación de forma longeva) y sugiere que se use el perfil Baseline. El asunto es que no hay mucho software libre en el mercado que permita la firma digital avanzada en PDF, sin embargo la propia Comisión Europea tiene un proyecto para ello (Digital Signature Services), que es un conjunto de librerías y herramientas en Java que permiten trabajar con firma digital con los estándares europeos, incluyendo soporte para PDF.&lt;/p&gt;
&lt;p&gt;Hasta no hace mucho tiempo, una de las pocas implementaciones libres para trabajar con firma digital avanzada en PDF era iText, sin embargo este proyecto cambió de licencia y las condiciones de uso contradecían la propia licencia, además de presuntas incompatibilidades en contribuciones del código por parte de terceros que la hacían incompatible con la nueva licencia. Afortunadamente, el proyecto DSS (usando Apache PDFBox como alternativa a iText) permite firmar documentos PDF cumpliendo con la política de formatos oficiales nacional.&lt;/p&gt;
&lt;h2&gt;Instalación en GNU/Linux&lt;/h2&gt;
&lt;p&gt;Existe un firmador en formato independiente que funciona en el escritorio. Se puede descargar &lt;a href="https://joinup.ec.europa.eu/sd-dss/webapp-demo/downloads/dss-app.zip"&gt;DSS standalone app package 5.0&lt;/a&gt; (este es el más reciente en el momento de escribir esta entrada de blog).&lt;/p&gt;
&lt;p&gt;Una vez descargado, descomprimir el tarball, contendrá dss-app.jar y un par de scripts para lanzar el jar de forma sencilla. El firmador que hay dentro del jar utiliza por defecto un servidor TSA europeo, para cambiarlo habrá que modificar un fichero que hay dentro del jar en la ruta spring/applicationContext.xml y buscar el texto: &lt;code&gt;http://tsa.belgium.be/connect&lt;/code&gt; para reemplazarlo por el siguiente: &lt;code&gt;http://tsa.sinpe.fi.cr/tsahttp/&lt;/code&gt; y guardarlo modificado con este cambio dentro del archivo jar (un archivo jar es un archivo zip realmente).&lt;/p&gt;
&lt;p&gt;Para poder ejecutar este jar en GNU/Linux se necesita el entorno JRE de OpenJDK 8 y además OpenJFX 8 (JavaFX). En Ubuntu se puede instalar con &lt;code&gt;sudo apt install openjfx&lt;/code&gt; y en Fedora mediante un repositorio COPR de terceros con &lt;code&gt;sudo dnf copr enable lenticularis/AVRConfig&lt;/code&gt; y luego &lt;code&gt;sudo dnf install openjfx&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Una vez instaladas las dependencias de Java, se puede ejecutar desde la terminal en la carpeta donde se haya descomprimido con &lt;code&gt;sh dss-run.sh&lt;/code&gt; o bien con &lt;code&gt;java -jar dss-app.jar&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Aparecerá una ventana como la siguiente:&lt;br&gt;
&lt;img class="alignnone size-medium wp-image-63" src="https://fran.cr/wp-content/uploads/2016/11/Captura-de-pantalla-de-2016-11-07-14-57-51.png" alt="Firmador DSS configurado" srcset="https://fran.cr/wp-content/uploads/2016/11/Captura-de-pantalla-de-2016-11-07-14-57-51.png 650w, https://fran.cr/wp-content/uploads/2016/11/Captura-de-pantalla-de-2016-11-07-14-57-51-300x179.png 300w" sizes="(max-width: 650px) 100vw, 650px"&gt;&lt;/p&gt;
&lt;h2&gt;Firmado de un documento PDF&lt;/h2&gt;
&lt;p&gt;En fichero a firmar (&lt;code&gt;File to sign&lt;/code&gt;) se selecciona el documento PDF que se desea firmar digitalmente.&lt;/p&gt;
&lt;p&gt;En formato de firma (&lt;code&gt;Signature format&lt;/code&gt;) se debe elegir PAdES porque se trata de un PDF.&lt;/p&gt;
&lt;p&gt;En PAdES solamente existe el formato envuelto (&lt;code&gt;Enveloped&lt;/code&gt;), por lo que este campo lo selecciona automáticamente.&lt;/p&gt;
&lt;p&gt;En el nivel (&lt;code&gt;Level&lt;/code&gt;) se elige el nivel de perfil de PAdES. PAdES-BASELINE-LTA es el equivalente a PAdES-LTV.&lt;/p&gt;
&lt;p&gt;En algoritmo de resumen hash encriptado (&lt;code&gt;Digest algorithm&lt;/code&gt;) se recomienda que sea como mínimo de tipo SHA-2, en la imagen de ejemplo se ha seleccionado SHA-512.&lt;/p&gt;
&lt;p&gt;En &lt;code&gt;Signature token API&lt;/code&gt; se tiene que seleccionar &lt;code&gt;PKCS #11&lt;/code&gt;, entonces se desplegará &lt;code&gt;PKCS #11 library&lt;/code&gt; donde hay que especificar dónde está la librería del módulo de Firma Digital (libASEP11.so).&lt;/p&gt;
&lt;p&gt;En contraseña (&lt;code&gt;Password&lt;/code&gt;) se ingresa el PIN de la tarjeta de Firma Digital.&lt;/p&gt;
&lt;p&gt;Cuando se presione sobre &lt;code&gt;Sign&lt;/code&gt; se iniciará el proceso de firmado y tras unos segundos aparecerá una ventana para guardar el PDF generado en la ubicación que se desee.&lt;/p&gt;
&lt;p&gt;Eso es todo. El documento PDF ya tiene una firma válida en el país.&lt;/p&gt;
&lt;h2&gt;Demostración de documento válido generado&lt;/h2&gt;
&lt;p&gt;Esta imagen muestra que la firma generada es válida en la aplicación Acrobat Reader DC:&lt;/p&gt;
&lt;p&gt;&lt;img class="alignnone size-medium wp-image-64" src="https://fran.cr/wp-content/uploads/2016/11/Captura-de-pantalla-de-2016-11-07-15-38-14.png" alt="Validando firma en Adobe Reader" srcset="https://fran.cr/wp-content/uploads/2016/11/Captura-de-pantalla-de-2016-11-07-15-38-14.png 1024w, https://fran.cr/wp-content/uploads/2016/11/Captura-de-pantalla-de-2016-11-07-15-38-14-300x190.png 300w, https://fran.cr/wp-content/uploads/2016/11/Captura-de-pantalla-de-2016-11-07-15-38-14-768x485.png 768w" sizes="(max-width: 1024px) 100vw, 1024px"&gt;&lt;/p&gt;
&lt;p&gt;Existen formas de validar la firma del documento PDF con software libre (para no tener que usar Acrobat Reader DC como en este ejemplo), pero se explicará en próximas entradas de blog.&lt;/p&gt;
&lt;p&gt;Aunque este firmador no tiene campo de estampa visible (“firma visible”), la política de documento oficial no indica que el documento requiera disponer este detalle visual en los PDF.&lt;/p&gt;</description><category>Firma digital</category><category>Software libre</category><guid>http://www.jaquerespeis.org/posts/como-firmar-documentos-pdf-con-firma-digital-de-costa-rica-con-software-libre/</guid><pubDate>Tue, 08 Nov 2016 03:11:42 GMT</pubDate></item><item><title>Cómo autenticarse en el Módulo de Firma Digital de la CCSS en GNU/Linux</title><link>http://www.jaquerespeis.org/posts/como-autenticarse-en-el-modulo-de-firma-digital-de-la-ccss-en-gnulinux/</link><dc:creator>JáquerEspeis</dc:creator><description>&lt;p&gt;El &lt;a href="https://aissfa.ccss.sa.cr/ModuloFirmaDigital/"&gt;Módulo de Firma Digital&lt;/a&gt; de la Caja Costarricense de Seguro Social en la actualidad utiliza la tecnología Java mediante el (obsolescente) sistema de plug-ins NPAPI de navegador para autenticarse en el sitio y poder así acceder a diversos servicios en línea.&lt;/p&gt;
&lt;p&gt;Este sitio tiene unos requerimientos particulares para los usuarios de sistemas operativos GNU/Linux que no resultan obvios sino más bien confusos. Si se ha instalado el sistema de Firma Digital de Costa Rica, esta página sigue sin funcionar y muestra un error con el mensaje:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Se ha generado un error en el certificado. Por favor verifique que la libreria PKCS11 se encuentra en la ruta: /usr/local/lib/libASEP11.so&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Este mensaje no significa lo que aparenta: copiar la librería en esa ruta no servirá de nada, de hecho el applet no la lee de ahí, probablemente sea un mensaje que se usaba para código en desuso actualmente. Este mensaje de error realmente aparece porque no encuentra los certificados de la jerarquía de las autoridades certificadoras en una ruta del sistema específica.&lt;/p&gt;
&lt;p&gt;Para solucionar este problema hay que crear los siguientes directorios en la raíz del sistema de ficheros:&lt;/p&gt;
&lt;pre&gt;sudo mkdir -p /Firma_Digital/CERTIFICADOS/&lt;/pre&gt;
&lt;p&gt;El applet java de la CCSS no lee datos del certstore (JKS) de Java, y en su lugar los lee de esa ruta específica en el caso de GNU/Linux y macOS, así que los certificados de la jerarquía CA hay que copiarlos allí solo para el uso de este applet en particular.&lt;/p&gt;
&lt;p&gt;Asumiendo que se ha descargado el fichero instalador de la web de soportefirmadigital y se ha descomprimido el zip en la carpeta Descargas de nuestro usuario, para copiarlos allí sería:&lt;/p&gt;
&lt;pre&gt;sudo cp ~/Descargas/Firma\ Digital/Certificados/* /Firma_Digital/CERTIFICADOS/&lt;/pre&gt;
&lt;p&gt;Con este paso el applet ya no mostraría este error pero todavía no encontraría la librería. Hay que crear otra carpeta donde ubicar la librería:&lt;/p&gt;
&lt;pre&gt;sudo mkdir /Firma_Digital/LIBRERIAS/&lt;/pre&gt;
&lt;p&gt;Y la copiamos ahí o creamos un enlace simbólico desde otra que tengamos en otro lugar del sistema de ficheros. En este ejemplo se copiará de la que se descomprimió del zip de soportefirmadigital:&lt;/p&gt;
&lt;pre&gt;sudo cp ~/Descargas/Firma\ Digital/Librería/x64/libASEP11.so /Firma_Digital/LIBRERIAS/&lt;/pre&gt;
&lt;p&gt;Si se usa un GNU/Linux de 32 bit hay que cambiar el x64 anterior por x86 en la línea anterior.&lt;/p&gt;
&lt;p&gt;Eso es todo. Ahora el applet de la página debería preguntar por el PIN y permitir seleccionar el certificado del usuario para poder autenticarse.&lt;/p&gt;</description><category>Firma digital</category><category>Software libre</category><guid>http://www.jaquerespeis.org/posts/como-autenticarse-en-el-modulo-de-firma-digital-de-la-ccss-en-gnulinux/</guid><pubDate>Wed, 02 Nov 2016 04:11:40 GMT</pubDate></item><item><title>Autotools básico</title><link>http://www.jaquerespeis.org/posts/autotools-basico/</link><dc:creator>JáquerEspeis</dc:creator><description>&lt;h1&gt;Propósito&lt;/h1&gt;
&lt;p&gt;Crear paquetes de código fuente utilizando las herramientas de construcción de GNU (Autoconf, Automake y Libtool) a partir de uno o más ficheros de código fuente y los ficheros &lt;kbd&gt;configure.ac&lt;/kbd&gt; y &lt;kbd&gt;Makefile.am&lt;/kbd&gt;.&lt;/p&gt;
&lt;p&gt;Esta guía muestra cómo a partir de un fichero fuente &lt;kbd&gt;holamundo.c&lt;/kbd&gt; y el par de ficheros mencionados anteriormente se generará un archivo llamado &lt;kbd&gt;holamundo-1.0.0.tar.gz&lt;/kbd&gt; que una vez desempaquetado se pueda compilar e instalar con el típico “&lt;kbd&gt;./configure &amp;amp;&amp;amp; make &amp;amp;&amp;amp; sudo make install&lt;/kbd&gt;“.&lt;/p&gt;
&lt;p&gt;En una próxima entrada se explicará cómo trabajar con dependencias (librerías).&lt;/p&gt;
&lt;h2&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#ventajas"&gt;&lt;/a&gt;Ventajas&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Portabilidad, permite generar makefiles compatibles con diferentes implementaciones de Make, múltiples compiladores e intérpretes y generar scripts compatibles con múltiples shell.&lt;/li&gt;
&lt;li&gt;Multiplataforma, los scripts generados facilitan las comprobaciones y configuraciones necesarias para generar una compilación cruzada, por ejemplo generar binarios para otra arquitectura agregando pocos parámetros.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#herramientas"&gt;&lt;/a&gt;Herramientas&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;kbd&gt;autoconf&lt;/kbd&gt;, se encarga de generar el script &lt;kbd&gt;configure&lt;/kbd&gt; a partir del fichero &lt;kbd&gt;configure.ac&lt;/kbd&gt;.&lt;/li&gt;
&lt;li&gt;&lt;kbd&gt;automake&lt;/kbd&gt;, genera el fichero &lt;kbd&gt;Makefile.in&lt;/kbd&gt; a partir del fichero &lt;kbd&gt;Makefile.am&lt;/kbd&gt;.&lt;/li&gt;
&lt;li&gt;&lt;kbd&gt;libtool&lt;/kbd&gt;, gestiona la creación de librerías estáticas y dinámicas, y también la &lt;em&gt;carga&lt;/em&gt; (en tiempo de ejecución) de librerías dinámicas.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Dentro del paquete &lt;kbd&gt;autoconf&lt;/kbd&gt; hay otras herramientas relevantes como &lt;kbd&gt;aclocal&lt;/kbd&gt; y &lt;kbd&gt;autoheader&lt;/kbd&gt;. En este ejemplo básico se ejecutan de forma automática todas las herramientas mencionadas utilizando la herramienta &lt;kbd&gt;autoreconf&lt;/kbd&gt;.&lt;/p&gt;
&lt;h2&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#herramientas-relacionadas"&gt;&lt;/a&gt;Herramientas relacionadas&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;kbd&gt;make&lt;/kbd&gt;, procesa archivos &lt;kbd&gt;Makefile&lt;/kbd&gt;. Existen varias implementaciones (GNU Make, BSD Make…) con algunas incompatibilidades que autotools solventa.&lt;/li&gt;
&lt;li&gt;&lt;kbd&gt;pkg-config&lt;/kbd&gt;, facilita información sobre la mayoría de las librerías instaladas en el sistema (ubicación, dependencias, versión, etc.).&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#hola-autotools"&gt;&lt;/a&gt;¡Hola, Autotools!&lt;/h1&gt;
&lt;p&gt;Para crear el ejemplo básico de paquete es conveniente disponer de una carpeta de trabajo para tenerlo mejor organizado.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Crear una carpeta &lt;kbd&gt;holamundo&lt;/kbd&gt; con una subcarpeta &lt;kbd&gt;src&lt;/kbd&gt; para el código fuente y a continuación ubicarse en la carpeta de trabajo:&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
&lt;pre&gt;mkdir -p holamundo/src
cd holamundo&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#srcholamundoc"&gt;&lt;/a&gt;src/holamundo.c&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Crear un fichero de código fuente C en &lt;kbd&gt;src/holamundo.c&lt;/kbd&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
&lt;pre&gt;#include &amp;lt;stdio.h&amp;gt;

int main() {
    printf("Hola Mundo!\n");

    return 0;
}&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#makefileam"&gt;&lt;/a&gt;Makefile.am&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Crear un fichero &lt;kbd&gt;Makefile.am&lt;/kbd&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight highlight-source-makefile"&gt;
&lt;pre&gt;bin_PROGRAMS = holamundo
holamundo_SOURCES = src/holamundo.c&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#configureac"&gt;&lt;/a&gt;configure.ac&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Ejecutar la herramienta &lt;kbd&gt;autoscan&lt;/kbd&gt; en la carpeta de trabajo. Creará un fichero llamado &lt;kbd&gt;configure.scan&lt;/kbd&gt; que hay que renombrar a &lt;kbd&gt;configure.ac&lt;/kbd&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
&lt;pre&gt;autoscan
mv configure.scan configure.ac&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Nos habrá generado un fichero &lt;kbd&gt;configure.ac&lt;/kbd&gt; parecido al siguiente:&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

AC_PREREQ([2.69])
AC_INIT([FULL-PACKAGE-NAME], [VERSION], [BUG-REPORT-ADDRESS])
AC_CONFIG_SRCDIR([src/holamundo.c])
AC_CONFIG_HEADERS([config.h])

# Checks for programs.
AC_PROG_CC

# Checks for libraries.

# Checks for header files.

# Checks for typedefs, structures, and compiler characteristics.

# Checks for library functions.

AC_CONFIG_FILES([Makefile])
AC_OUTPUT&lt;/pre&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Modificar la macro &lt;kbd&gt;AC_INIT&lt;/kbd&gt; del fichero &lt;kbd&gt;configure.ac&lt;/kbd&gt; para mostrar el nombre del paquete, versión y dirección para avisar sobre errores (correo electrónico o web):&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;AC_INIT([holamundo], [1.0.0], [****@fran.cr])
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Agregar la macro &lt;kbd&gt;AM_INIT_AUTOMAKE&lt;/kbd&gt; en el fichero &lt;kbd&gt;configure.ac&lt;/kbd&gt; para poder generar los Makefiles. Un buen lugar sería después de la línea de &lt;kbd&gt;AC_CONFIG_HEADERS&lt;/kbd&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;AM_INIT_AUTOMAKE([foreign subdir-objects])
&lt;/pre&gt;
&lt;p&gt;Una vez modificado el fichero &lt;kbd&gt;configure.ac&lt;/kbd&gt; debería ser parecido al siguiente:&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

AC_PREREQ([2.69])
AC_INIT([holamundo], [1.0.0], [****@fran.cr])
AC_CONFIG_SRCDIR([src/holamundo.c])
AC_CONFIG_HEADERS([config.h])
AM_INIT_AUTOMAKE([foreign subdir-objects])

# Checks for programs.
AC_PROG_CC

# Checks for libraries.

# Checks for header files.

# Checks for typedefs, structures, and compiler characteristics.

# Checks for library functions.

AC_CONFIG_FILES([Makefile])
AC_OUTPUT&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#generar-configure-y-makefilein"&gt;&lt;/a&gt;Generar configure y Makefile.in&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Ejecutar:&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
&lt;pre&gt;autoreconf -i&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#generar-makefile"&gt;&lt;/a&gt;Generar Makefile&lt;/h2&gt;
&lt;div&gt;
&lt;pre&gt;./configure&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#generar-paquete-tarball"&gt;&lt;/a&gt;Generar paquete (“tarball”)&lt;/h2&gt;
&lt;div&gt;
&lt;pre&gt;make dist&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;Se habrá generado &lt;kbd&gt;holamundo-1.0.0.tar.gz&lt;/kbd&gt;&lt;/p&gt;
&lt;h1&gt;&lt;a href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#instalaci%C3%B3n-gen%C3%A9rica-del-paquete"&gt;&lt;/a&gt;Instalación genérica del paquete&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Descomprimir:&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
&lt;pre&gt;tar xf holamundo-1.0.0.tar.gz&lt;/pre&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Entrar en la carpeta comprimida:&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
&lt;pre&gt;cd holamundo-1.0.0&lt;/pre&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Generar Makefile:&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
&lt;pre&gt;./configure&lt;/pre&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Construir:&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
&lt;pre&gt;make&lt;/pre&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Instalar:&lt;/li&gt;
&lt;/ul&gt;
&lt;div&gt;
&lt;pre&gt;sudo make install&lt;/pre&gt;
&lt;/div&gt;
&lt;h1&gt;&lt;a id="user-content-detalles-de-los-ficheros-creados" href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#detalles-de-los-ficheros-creados"&gt;&lt;/a&gt;Detalles de los ficheros creados&lt;/h1&gt;
&lt;h2&gt;&lt;a id="user-content-makefileam-1" href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#makefileam-1"&gt;&lt;/a&gt;Makefile.am&lt;/h2&gt;
&lt;p&gt;&lt;kbd&gt;bin_PROGRAMS&lt;/kbd&gt; indica la lista de programas (binarios en este caso) que va a crearse. En este caso se va a crear un binario llamado &lt;kbd&gt;holamundo&lt;/kbd&gt;.&lt;/p&gt;
&lt;p&gt;&lt;kbd&gt;holamundo_SOURCES&lt;/kbd&gt; indica que nuestro &lt;kbd&gt;holamundo&lt;/kbd&gt; tiene un listado de &lt;kbd&gt;_SOURCES&lt;/kbd&gt; (ficheros fuente). En este ejemplo solamente hay uno (&lt;kbd&gt;src/holamundo.c&lt;/kbd&gt;). Si el proyecto tuviera más ficheros de código fuente para crear el programa se separan con espacios. Si se desea poner un fichero por línea para hacer el mantenimiento de &lt;kbd&gt;Makefile.am&lt;/kbd&gt; más limpio se puede utilizar &lt;kbd&gt;\&lt;/kbd&gt; al final de la línea para indicar que continúa en la siguiente, por lo tanto:&lt;/p&gt;
&lt;pre&gt;holamundo_SOURCES = \
    fichero1.c \
    fichero2.c \
    fichero3.c
&lt;/pre&gt;
&lt;p&gt;es lo mismo que:&lt;/p&gt;
&lt;pre&gt;holamundo_SOURCES = fichero1.c fichero2.c fichero3.c
&lt;/pre&gt;
&lt;h2&gt;&lt;a id="user-content-configureac-1" href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#configureac-1"&gt;&lt;/a&gt;configure.ac&lt;/h2&gt;
&lt;p&gt;&lt;kbd&gt;foreign&lt;/kbd&gt; indica que no se está creando un paquete GNU estándar (no exigirá la existencia de los ficheros &lt;kbd&gt;ChangeLog&lt;/kbd&gt;, &lt;kbd&gt;COPYING&lt;/kbd&gt;, &lt;kbd&gt;NEWS&lt;/kbd&gt; y &lt;kbd&gt;README&lt;/kbd&gt; para funcionar).&lt;/p&gt;
&lt;p&gt;&lt;kbd&gt;subdir-objects&lt;/kbd&gt; indica que se está usando el modo recursivo, es decir, no se van a usar múltiples ficheros Makefile.am para cada carpeta con objetivos a procesar.&lt;/p&gt;
&lt;p&gt;&lt;kbd&gt;AC_PREREQ&lt;/kbd&gt; indica la versión mínima de autoconf requerida para funcionar con el archivo de configuración.&lt;/p&gt;
&lt;p&gt;&lt;kbd&gt;AC_CONFIG_SRCDIR&lt;/kbd&gt; comprueba que el código fuente existe en la carpeta indicada mediante la comprobación de algún fichero fuente de la misma.&lt;/p&gt;
&lt;p&gt;&lt;kbd&gt;AC_CONFIG_HEADERS&lt;/kbd&gt; indica el nombre que tendrá el archivo de configuración de código fuente generado. Esto permite crear definiciones (por ejemplo, &lt;kbd&gt;#define LOQUESEA 1&lt;/kbd&gt;) en el archivo indicado (por defecto, &lt;kbd&gt;config.h&lt;/kbd&gt;) que podrá ser incluido en el código fuente. Estas definiciones podrían variar según lo que compruebe el script &lt;kbd&gt;configure&lt;/kbd&gt;, resultando muy útil por ejemplo para verificar si el programa se ha compilado con o sin soporte de una característica en particular, por ejemplo para dependencias opcionales de librerías o comprobaciones de funcionalidad del compilador o de un sistema operativo en tiempo de compilación.&lt;/p&gt;
&lt;p&gt;&lt;kbd&gt;AC_PROG_CC&lt;/kbd&gt; comprueba la existencia de un compilador de C. Como autoscan ha detectado código fuente en C se ha agregado esta macro automáticamente.&lt;/p&gt;
&lt;p&gt;&lt;kbd&gt;AC_CONFIG_FILES&lt;/kbd&gt; recibe en el primer parámetro una lista de ficheros separados con espacios. (en este caso solo &lt;kbd&gt;Makefile&lt;/kbd&gt;, que generará a partir de &lt;kbd&gt;Makefile.in&lt;/kbd&gt;). Los ficheros con extensión .in se utilizan para sustituir los valores de las variables que contienen y generar el archivo de salida, normalmente con el mismo nombre sin el &lt;kbd&gt;.in&lt;/kbd&gt;. Este proceso lo realiza la macro &lt;kbd&gt;AC_OUTPUT&lt;/kbd&gt;.&lt;/p&gt;
&lt;h2&gt;&lt;a id="user-content-algunos-parámetros-del-script-configure" href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#algunos-par%C3%A1metros-del-script-configure"&gt;&lt;/a&gt;Algunos parámetros del script configure&lt;/h2&gt;
&lt;p&gt;El parámetro &lt;kbd&gt;--prefix&lt;/kbd&gt; permite indicar el directorio base de instalación, que por defecto suele ser &lt;kbd&gt;/usr/local&lt;/kbd&gt;. Por ejemplo el programa &lt;kbd&gt;holamundo&lt;/kbd&gt; se copiaría por defecto a la carpeta &lt;kbd&gt;/usr/local/bin&lt;/kbd&gt; si no se cambia el &lt;kbd&gt;--prefix&lt;/kbd&gt;. Las distribuciones suelen usar en sus paquetes &lt;kbd&gt;--prefix=/usr&lt;/kbd&gt;. Si se quiere instalar un paquete y no se tienen permisos de superusuario se podría indicar una ruta dentro de la $HOME donde usualmente se suelen tener permisos de escritura.&lt;/p&gt;
&lt;p&gt;&lt;kbd&gt;./configure --help&lt;/kbd&gt; muestra información detallada de los parámetros.&lt;/p&gt;
&lt;h3&gt;&lt;a id="user-content-compilación-cruzada-con-el-script-configure" href="https://github.com/JaquerEspeis/webespeis/blob/master/posts/autotools-basico.md#compilaci%C3%B3n-cruzada-con-el-script-configure"&gt;&lt;/a&gt;Compilación cruzada con el script configure&lt;/h3&gt;
&lt;p&gt;El parámetro &lt;kbd&gt;--host&lt;/kbd&gt; permite utilizar de forma sencilla toolchains para compilación cruzada, por ejemplo en una máquina Intel con Ubuntu e instalando el paquete &lt;kbd&gt;gcc-arm-linux-gnueabihf&lt;/kbd&gt; proporciona el toolchain para ARMv7 (hard float) y puede realizarse esto:&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;./configure --host=arm-linux-gnueabihf
make&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;A continuación podemos verificar que el ejecutable &lt;kbd&gt;holamundo&lt;/kbd&gt; es un ELF para arquitectura ARM y no para Intel mediante:&lt;/p&gt;
&lt;div&gt;
&lt;pre&gt;file holamundo&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;por lo que podremos comprobar que efectivamente se utilizaron las herramientas del toolchain sin tener que prefijar individualmente compilador, enlazador y demás ejecutables.&lt;/p&gt;</description><category>Software libre</category><guid>http://www.jaquerespeis.org/posts/autotools-basico/</guid><pubDate>Sat, 23 Jul 2016 23:07:17 GMT</pubDate></item><item><title>Cómo instalar Firma Digital de Costa Rica en GNU/Linux Ubuntu 16.04</title><link>http://www.jaquerespeis.org/posts/instalar-firma-digital-costa-rica-gnu-linux-ubuntu-16-04/</link><dc:creator>JáquerEspeis</dc:creator><description>&lt;p&gt;Esta guía documenta cómo instalar el controlador de la tarjeta de Firma Digital de Costa Rica y la jerarquía de certificados del Banco Central (SINPE) y del MICITT en el sistema operativo Ubuntu 16.04 de arquitectura Intel de 64 bits (x86_64). Para otros sistemas operativos se documentará más adelante.&lt;/p&gt;
&lt;p&gt;El motivo de esta nueva guía de instalación tenía los siguientes propósitos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Configurar de la forma más sencilla y adecuada el sistema para que funcione con la mayor cantidad de programas.&lt;/li&gt;
&lt;li&gt;Lograr que funcione para todos los usuarios del sistema, incluyendo los nuevos usuarios creados tras las instalación.&lt;/li&gt;
&lt;li&gt;Superar la prueba de firma digital (con applet Java) en el sitio web de Soporte Firma Digital con el navegador Mozilla Firefox.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Instalación de las dependencias&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Instalar el soporte CCID de PC/SC para que reconozca el lector de tarjetas y el plugin NPAPI IcedTea-Web para poder cargar el applet Java que permite firmar desde el navegador Firefox:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo apt -y install pcscd icedtea-plugin
&lt;/pre&gt;
&lt;h2&gt;Descarga del “instalador”&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Descargar el “instalador” en el desplegable llamado “Usuarios Linux” en la página de descarga de instaladores del sitio web de &lt;a href="https://www.soportefirmadigital.com/"&gt;Soporte Firma Digital de Costa Rica&lt;/a&gt;, introduciendo el número de serie de la tarjeta y el captcha.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Desempaquetado del “instalador”&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Descomprimir el archivo zip descargado, en el momento de escribir esta documentación se llama &lt;kbd&gt;sfd_ClientesLinux_Rev08.zip&lt;/kbd&gt;. Se creará una carpeta llamada &lt;kbd&gt;Firma Digital&lt;/kbd&gt;. Se asume que se ha descomprimido dentro de la carpeta &lt;kbd&gt;Descargas&lt;/kbd&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Instalación de los certificados&lt;/h2&gt;
&lt;p&gt;Es necesario agregar a la lista de confianza la jerarquía de certificados del SINPE y del MICITT. Para ello, un conjunto de comandos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Copiar los certificados:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo cp Descargas/Firma\ Digital/Certificados/* /usr/local/share/ca-certificates/

sudo rename.ul .cer .crt /usr/local/share/ca-certificates/*.cer

for file in /usr/local/share/ca-certificates/*.crt; do sudo openssl x509 -inform DER -in "$file" -out "$file"; done 2&amp;gt;/dev/null
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Regenerar los archivos de certificados para todas las aplicaciones:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo update-ca-certificates --fresh
&lt;/pre&gt;
&lt;h2&gt;Instalación del módulo PKCS#11&lt;/h2&gt;
&lt;p&gt;En Ubuntu todavía no existe una inciativa como la que existe en Fedora para solucionar el problema de unificación de NSS con Firefox, por lo que he considerado realizar un hack bastante intrusivo pero funcional para reemplazar las librerías NSS que resista a actualizaciones de Firefox, Thunderbird y NSS, siempre y cuando no haya cambios en la ubicación de las librerías, que es menos probable.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Copiar el módulo PKCS#11 propietario en &lt;kbd&gt;/usr/lib/x86_64-linux-gnu/pkcs11/&lt;/kbd&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo cp Descargas/Firma\ Digital/Librería/x64/libASEP11.so /usr/lib/x86_64-linux-gnu/pkcs11/&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Crear los siguientes enlaces simbólicos (necesarios para que funcionen algunos programas y applets):&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo ln -s /usr/lib/x86_64-linux-gnu/pkcs11/libASEP11.so /usr/lib/x86_64-linux-gnu/

sudo ln -s /usr/lib/x86_64-linux-gnu/pkcs11/libASEP11.so /usr/lib/
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Crear el fichero /etc/Athena/IDPClientDB.xml y abrirlo para edición:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo mkdir /etc/Athena/

sudo gedit /etc/Athena/IDPClientDB.xml
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;En la ventana del editor de textos gedit, pegar el siguiente texto, guardar y cerrar el editor:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&amp;lt;?xml version="1.0" encoding="utf-8" ?&amp;gt;
&amp;lt;IDProtect&amp;gt;
 &amp;lt;TokenLibs&amp;gt;
  &amp;lt;IDProtect&amp;gt;
   &amp;lt;Cards&amp;gt;
    &amp;lt;IDProtectXF&amp;gt;
     &amp;lt;ATR type='hexBinary'&amp;gt;3BDC00FF8091FE1FC38073C821106600000000000000&amp;lt;/ATR&amp;gt;
     &amp;lt;ATRMask type='hexBinary'&amp;gt;FFFF00FFF0FFFFFFFFFFFFFFFFF0FF00000000000000&amp;lt;/ATRMask&amp;gt;
    &amp;lt;/IDProtectXF&amp;gt;
   &amp;lt;/Cards&amp;gt;
  &amp;lt;/IDProtect&amp;gt;
 &amp;lt;/TokenLibs&amp;gt;
&amp;lt;/IDProtect&amp;gt;
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Crear un fichero llamado &lt;kbd&gt;/etc/pkcs11/modules/firmadigital.module&lt;/kbd&gt; y abrirlo para edición:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo mkdir -p /etc/pkcs11/modules/

sudo gedit /etc/pkcs11/modules/firmadigital.module
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;En la ventana del editor de textos gedit, pegar el siguiente texto, guardar y cerrar el editor:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;module: libASEP11.so
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Crear un fichero llamado &lt;kbd&gt;/usr/local/sbin/update-p11-kit-symlinks&lt;/kbd&gt; y abrirlo para edición:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo gedit /usr/local/sbin/update-p11-kit-symlinks
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;En la ventana del editor de textos gedit, pegar el siguiente texto, guardar y cerrar el editor:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;#!/bin/sh

FIREFOX_LIB=/usr/lib/firefox/libnssckbi.so
THUNDERBIRD_LIB=/usr/lib/thunderbird/libnssckbi.so

if ! [ -L "$FIREFOX_LIB" ]
then
    echo "Firefox libnssckbi.so is not a symlink. Fixing..."
    mv -f "$FIREFOX_LIB" "$FIREFOX_LIB".bak
    ln -s /usr/lib/x86_64-linux-gnu/p11-kit-proxy.so "$FIREFOX_LIB"
fi

if ! [ -L "$THUNDERBIRD_LIB" ]
then
    echo "Thunderbird libnssckbi.so is not a symlink. Fixing..."
    mv -f "$THUNDERBIRD_LIB" "$THUNDERBIRD_LIB".bak
    ln -s /usr/lib/x86_64-linux-gnu/p11-kit-proxy.so "$THUNDERBIRD_LIB"
fi
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Agregar el atributo de ejecutable al script:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo chmod +x /usr/local/sbin/update-p11-kit-symlinks
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Crear un fichero llamado &lt;kbd&gt;/etc/systemd/system/p11-kit-proxy-updater.service&lt;/kbd&gt; y abrirlo para edición:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo gedit /etc/systemd/system/p11-kit-proxy-updater.service 
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;En la ventana del editor de textos gedit, pegar el siguiente texto, guardar y cerrar el editor:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;[Unit]
Description=mantenimiento de enlaces a p11-kit-proxy

[Service]
Type=oneshot
ExecStart=/usr/local/sbin/update-p11-kit-symlinks

[Install]
WantedBy=multi-user.target
&lt;/pre&gt;
&lt;p&gt;Activar el servicio al arranque y ejecutarlo una primera vez para comprobar que funciona:&lt;/p&gt;
&lt;pre&gt;sudo systemctl enable p11-kit-proxy-updater.service

sudo systemctl start p11-kit-proxy-updater.service
&lt;/pre&gt;
&lt;p&gt;Eso es todo. Es necesario reiniciar Firefox, Thunderbird y cualquier otra aplicación que use certificados para que se apliquen los cambios. Si se ha insertado el lector y la tarjeta al lector, estas aplicaciones preguntarán por el PIN, lo que indicará que se la instalación ha sido exitosa.&lt;/p&gt;
&lt;p&gt;En Firefox (hasta la versión 51 y la 52 ESR) ya se puede ir a realizar la prueba en el enlace “Verificación de Capacidad de Firma” del sitio web de Soporte Firma Digital de Costa Rica mencionado anteriormente y debería pasarla con éxito. En el navegador aparecerá que se quiere ejecutar “IcedTea-Web”, hay que permitirlo. Si el navegador hace preguntas sobre el applet responder afirmativamente y aceptar a todos los cuadros de mensaje que aparezcan e ingresar el PIN cuando lo solicite.&lt;/p&gt;</description><category>Firma digital</category><category>Software libre</category><guid>http://www.jaquerespeis.org/posts/instalar-firma-digital-costa-rica-gnu-linux-ubuntu-16-04/</guid><pubDate>Sat, 09 Jul 2016 02:07:05 GMT</pubDate></item><item><title>Cómo instalar Firma Digital de Costa Rica en GNU/Linux Fedora 24</title><link>http://www.jaquerespeis.org/posts/instalar-firma-digital-costa-rica-linux-fedora-24/</link><dc:creator>JáquerEspeis</dc:creator><description>&lt;p&gt;Esta guía documenta cómo instalar el controlador de la tarjeta de Firma Digital de Costa Rica y la jerarquía de certificados del Banco Central (SINPE) y del MICITT en el sistema operativo Fedora 24 de arquitectura Intel de 64 bits (x86_64). Para otros sistemas operativos se documentará más adelante.&lt;/p&gt;
&lt;p&gt;El motivo de esta nueva guía de instalación tenía los siguientes propósitos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Configurar de la forma más sencilla y adecuada el sistema para que funcione con la mayor cantidad de programas.&lt;/li&gt;
&lt;li&gt;Lograr que funcione para todos los usuarios del sistema, incluyendo los nuevos usuarios creados tras las instalación.&lt;/li&gt;
&lt;li&gt;Superar la prueba de firma digital (con applet Java) en el sitio web de Soporte Firma Digital con el navegador Mozilla Firefox.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Instalación de las dependencias&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Instalar el soporte CCID de PC/SC para que reconozca el lector de tarjetas y el plugin NPAPI IcedTea-Web para poder cargar el applet Java que permite firmar desde el navegador Firefox:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;
sudo dnf -y install pcsc-lite-ccid icedtea-web

sudo systemctl enable pcscd.service

sudo systemctl start pcscd.service
&lt;/pre&gt;
&lt;h2&gt;Descarga del “instalador”&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Descargar el “instalador” en el desplegable llamado “Usuarios Linux” en la página de descarga de instaladores del sitio web de &lt;a href="https://www.soportefirmadigital.com/"&gt;Soporte Firma Digital de Costa Rica&lt;/a&gt;, introduciendo el número de serie de la tarjeta y el captcha.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Desempaquetado del “instalador”&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Descomprimir el archivo zip descargado, en el momento de escribir esta documentación se llama &lt;kbd&gt;sfd_ClientesLinux_Rev08.zip&lt;/kbd&gt;. Se creará una carpeta llamada &lt;kbd&gt;Firma Digital&lt;/kbd&gt;. Se asume que se ha descomprimido dentro de la carpeta &lt;kbd&gt;Descargas&lt;/kbd&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Instalación de los certificados&lt;/h2&gt;
&lt;p&gt;Es necesario agregar a la lista de confianza la jerarquía de certificados del SINPE y del MICITT. Para ello, un par de comandos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Copiar los certificados:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;
sudo cp Descargas/Firma\ Digital/Certificados/* /usr/share/pki/ca-trust-source/anchors/
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Regenerar los archivos de certificados para todas las aplicaciones:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;
sudo update-ca-trust
&lt;/pre&gt;
&lt;h2&gt;Instalación del módulo PKCS#11&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Copiar el módulo PKCS#11 propietario en &lt;kbd&gt;/usr/lib64/pkcs11&lt;/kbd&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;sudo cp Descargas/Firma\ Digital/Librería/x64/libASEP11.so /usr/lib64/pkcs11/&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Crear los siguientes enlaces simbólicos (necesarios para que funcionen algunos programas y applets):&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;
sudo ln -s /usr/lib64/pkcs11/libASEP11.so /usr/lib64/

sudo ln -s /usr/lib64/pkcs11/libASEP11.so /usr/lib/
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Crear el fichero /etc/Athena/IDPClientDB.xml y abrirlo para edición:
&lt;/li&gt;&lt;/ul&gt;
&lt;pre&gt;
sudo mkdir /etc/Athena/

sudo gedit /etc/Athena/IDPClientDB.xml
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;En la ventana del editor de textos gedit, pegar el siguiente texto, guardar y cerrar el editor:
&lt;/li&gt;&lt;/ul&gt;
&lt;pre&gt;&amp;lt;?xml version="1.0" encoding="utf-8" ?&amp;gt;
&amp;lt;IDProtect&amp;gt;
 &amp;lt;TokenLibs&amp;gt;
  &amp;lt;IDProtect&amp;gt;
   &amp;lt;Cards&amp;gt;
    &amp;lt;IDProtectXF&amp;gt;
     &amp;lt;ATR type='hexBinary'&amp;gt;3BDC00FF8091FE1FC38073C821106600000000000000&amp;lt;/ATR&amp;gt;
     &amp;lt;ATRMask type='hexBinary'&amp;gt;FFFF00FFF0FFFFFFFFFFFFFFFFF0FF00000000000000&amp;lt;/ATRMask&amp;gt;
    &amp;lt;/IDProtectXF&amp;gt;
   &amp;lt;/Cards&amp;gt;
  &amp;lt;/IDProtect&amp;gt;
 &amp;lt;/TokenLibs&amp;gt;
&amp;lt;/IDProtect&amp;gt;
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Crear un fichero llamado &lt;kbd&gt;/etc/pkcs11/modules/firmadigital.module&lt;/kbd&gt; y abrirlo para edición:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;
sudo gedit /etc/pkcs11/modules/firmadigital.module
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;En la ventana del editor de textos gedit, pegar el siguiente texto, guardar y cerrar el editor:
&lt;/li&gt;&lt;/ul&gt;
&lt;pre&gt;
module: libASEP11.so
&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Ejecutar el siguiente comando para reemplazar el enlace simbólico a &lt;kbd&gt;libnssckbi&lt;/kbd&gt; para que haga uso de &lt;kbd&gt;p11-kit-proxy&lt;/kbd&gt; de forma prioritaria:&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;
sudo alternatives --install /usr/lib64/libnssckbi.so libnssckbi.so.x86_64 /usr/lib64/p11-kit-proxy.so 50
&lt;/pre&gt;
&lt;p&gt;Eso es todo. Es necesario reiniciar Firefox, Evolution y cualquier otra aplicación que use certificados para que se apliquen los cambios. Si se ha insertado el lector y la tarjeta al lector, estas aplicaciones preguntarán por el PIN, lo que indicará que se la instalación ha sido exitosa.&lt;/p&gt;
&lt;p&gt;En Firefox ya se puede ir a realizar la prueba en el enlace “Verificación de Capacidad de Firma” del sitio web de Soporte Firma Digital de Costa Rica mencionado anteriormente y debería pasarla con éxito. En el navegador aparecerá que se quiere ejecutar “IcedTea-Web”, hay que permitirlo. Si el navegador hace preguntas sobre el applet responder afirmativamente y aceptar a todos los cuadros de mensaje que aparezcan e ingresar el PIN cuando lo solicite.&lt;/p&gt;</description><category>Firma digital</category><category>Software libre</category><guid>http://www.jaquerespeis.org/posts/instalar-firma-digital-costa-rica-linux-fedora-24/</guid><pubDate>Thu, 07 Jul 2016 20:07:09 GMT</pubDate></item><item><title>Cómo configurar Firma Digital de Costa Rica en GNU/Linux Fedora 23</title><link>http://www.jaquerespeis.org/posts/configurar-firma-digital-de-costa-rica-en-gnu-linux-fedora/</link><dc:creator>JáquerEspeis</dc:creator><description>&lt;p&gt;&lt;strong&gt;Actualización 2:&lt;/strong&gt; esta guía ha quedado obsoleta, se recomienda seguir la guía para Fedora 24, que probablemente también funcione para Fedora 23, incluye cómo instalar los certificados y funcionalidad para todos los usuarios del sistema.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Actualización:&lt;/strong&gt; la configuración del XML de esta guía ya no es necesaria si se instala el RPM del nuevo instalador que proporciona el centro de soporte de Firma Digital. Antes el instalador solamente incluía paquetes DEB.&lt;/p&gt;
&lt;h2&gt;Requerimientos&lt;/h2&gt;
&lt;p&gt;Instalar el controlador del lector de tarjetas y sus dependencias:&lt;/p&gt;
&lt;pre&gt;sudo dnf -y install pcsc-lite-ccid&lt;/pre&gt;
&lt;p&gt;Iniciar el servicio &lt;kbd&gt;pcscd&lt;/kbd&gt; si no lo está:&lt;/p&gt;
&lt;pre&gt;sudo systemctl start pcscd&lt;/pre&gt;
&lt;p&gt;Para asegurarse de que el servicio &lt;kbd&gt;pcscd&lt;/kbd&gt; se inicie al arrancar el sistema:&lt;/p&gt;
&lt;pre&gt;sudo systemctl enable pcscd&lt;/pre&gt;
&lt;h2&gt;Descarga&lt;/h2&gt;
&lt;p&gt;Descargar el “instalador” para usuarios Linux en la sección de descargas del &lt;a href="https://www.soportefirmadigital.com/"&gt;centro de soporte de Firma Digital&lt;/a&gt; y descomprimir el zip.&lt;/p&gt;
&lt;h2&gt;Solución de problemas&lt;/h2&gt;
&lt;p&gt;Para que el módulo PKCS#11 funcione correctamente con las tarjetas inteligentes de Firma Digital más recientes se tiene que crear un archivo XML en una ruta específica del sistema:&lt;/p&gt;
&lt;pre&gt;sudo mkdir /etc/Athena
sudo gedit /etc/Athena/IDPClientDB.xml
&lt;/pre&gt;
&lt;p&gt;En la ventana del editor de textos gedit, pegar el siguiente texto:&lt;/p&gt;
&lt;pre&gt;&amp;lt;?xml version="1.0" encoding="utf-8" ?&amp;gt;
&amp;lt;IDProtect&amp;gt;
 &amp;lt;TokenLibs&amp;gt;
  &amp;lt;IDProtect&amp;gt;
   &amp;lt;Cards&amp;gt;
    &amp;lt;IDProtectXF&amp;gt;
     &amp;lt;ATR type='hexBinary'&amp;gt;3BDC00FF8091FE1FC38073C821106600000000000000&amp;lt;/ATR&amp;gt;
     &amp;lt;ATRMask type='hexBinary'&amp;gt;FFFF00FFF0FFFFFFFFFFFFFFFFF0FF00000000000000&amp;lt;/ATRMask&amp;gt;
    &amp;lt;/IDProtectXF&amp;gt;
   &amp;lt;/Cards&amp;gt;
  &amp;lt;/IDProtect&amp;gt;
 &amp;lt;/TokenLibs&amp;gt;
&amp;lt;/IDProtect&amp;gt;
&lt;/pre&gt;
&lt;p&gt;Guardar. Ahora ya está lista para probar.&lt;/p&gt;
&lt;p&gt;Se pueden seguir los pasos de configuración del módulo indicados en el sitio web del centro de soporte de Firma Digital para Firefox si así se desea.&lt;/p&gt;
&lt;h2&gt;Prueba&lt;/h2&gt;
&lt;p&gt;Para comprobar por línea de comandos si el módulo PKCS#11 reconoce la tarjeta:&lt;/p&gt;
&lt;p&gt;Instalar el paquete &lt;kbd&gt;opensc&lt;/kbd&gt;, que proporciona la herramienta &lt;kbd&gt;pkcs11-tool&lt;/kbd&gt;:&lt;/p&gt;
&lt;pre&gt;sudo dnf -y install opensc&lt;/pre&gt;
&lt;p&gt;Realizar una prueba de listado de objetos, que pedirá el PIN:&lt;/p&gt;
&lt;pre&gt;pkcs11-tool --module "~/Descargas/Firma Digital/Firma Digital/Libreria/x64/libASEP11.so" -l -O&lt;/pre&gt;
&lt;p&gt;Reemplazar la ruta hacia &lt;kbd&gt;libASEP11.so&lt;/kbd&gt; del ejemplo por la adecuada.&lt;/p&gt;
&lt;p&gt;Si funcionó correctamente deberá mostrar que existen 2 certificados y 2 claves. Ejemplo de la salida:&lt;/p&gt;
&lt;pre&gt;Using slot 0 with a present token (0x0)
Logging in to "IDProtect#XXXXXXXXXXXXXXXX".
Please enter User PIN:
Certificate Object, type = X.509 cert
label: XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXX
ID: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
Certificate Object, type = X.509 cert
label: XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXX
ID: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
Private Key Object; RSA
label: XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXXX
ID: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
Usage: decrypt, sign
Private Key Object; RSA
label: XXXXXXXX-XXXX-XXXX-XXXXXXXXXXXXXXX
ID: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
Usage: sign
&lt;/pre&gt;</description><category>Firma digital</category><category>Software libre</category><guid>http://www.jaquerespeis.org/posts/configurar-firma-digital-de-costa-rica-en-gnu-linux-fedora/</guid><pubDate>Thu, 30 Jun 2016 10:06:28 GMT</pubDate></item><item><title>Cómo configurar Evolution para enviar correos electrónicos firmados digitalmente</title><link>http://www.jaquerespeis.org/posts/configurar-evolution-correo-electronico-firma-digital/</link><dc:creator>JáquerEspeis</dc:creator><description>&lt;p&gt;&lt;strong&gt;Actualización:&lt;/strong&gt; Se recomienda seguir las guías actualizadas que permiten configurar firma digital para todos los usuarios del sistema. Esta guía ya ha quedado anticuada, no se recomienda porque requiere configurarlo para cada nuevo usuario.&lt;/p&gt;
&lt;p&gt;Evolution es la suite de trabajo en grupo del escritorio GNOME. Dispone de correo electrónico, contactos, calendario, tareas y notas, que se integran con las cuentas del sistema.&lt;/p&gt;
&lt;p&gt;Se puede configurar para utilizar el sistema de Firma Digital de Costa Rica y enviar correos firmados. Esta característica está documentada en el &lt;a href="https://www.soportefirmadigital.com/"&gt;centro de soporte de Firma Digital&lt;/a&gt; para la aplicación Mozilla Thunderbird. Sin embargo, no existe una guía para configurarla para Evolution, si bien configurarla no es tan amigable en versiones actuales.&lt;/p&gt;
&lt;p&gt;Evolution ofrece facilidades para configurar certificados desde ficheros de certificado (PKCS#12) pero en el caso de Firma Digital se requiere un módulo (PKCS#11) y &lt;strong&gt;la interfaz gráfica no tiene la opción&lt;/strong&gt;, por lo que hay que seguir los siguientes pasos:&lt;/p&gt;
&lt;p&gt;Agregar confianza a los certificados de Firma Digital en el menú Editar -&amp;gt; Preferencias -&amp;gt; icono Certificados -&amp;gt; Pestaña Autoridades -&amp;gt; Importar del mismo modo que se hace con Firefox o con Thunderbird.&lt;/p&gt;
&lt;p&gt;Cerrar Evolution si está abierto para evitar problemas de bloqueo y concurrencia en la base de datos.&lt;/p&gt;
&lt;p&gt;Asociar el módulo PKCS#11 de Firma Digital a la base de datos:&lt;/p&gt;
&lt;pre&gt;modutil -add "Firma Digital" -libfile /ruta/al/modulo/libASEP11.so -dbdir ~/.pki/nssdb/&lt;/pre&gt;
&lt;p&gt;Reemplazar la ruta hacia &lt;kbd&gt;libASEP11.so&lt;/kbd&gt; del ejemplo por la adecuada.&lt;/p&gt;
&lt;p&gt;Editar el archivo pkcs11.txt:&lt;/p&gt;
&lt;pre&gt;gedit ~/.pki/nssdb/pkcs11.txt&lt;/pre&gt;
&lt;p&gt;Agregar dos líneas nuevas al principio y no borrar las existentes:&lt;/p&gt;
&lt;pre&gt;library=/ruta/al/modulo/libASEP11.so
name=Firma Digital
&lt;/pre&gt;
&lt;p&gt;Reemplazar la ruta hacia &lt;kbd&gt;libASEP11.so&lt;/kbd&gt; del ejemplo por la adecuada (la misma que se haya indicado en el paso anterior).&lt;/p&gt;
&lt;p&gt;Guardar los cambios y cerrar gedit. Abrir Evolution. Si todo ha ido bien pedirá el PIN del dispositivo.&lt;/p&gt;
&lt;p&gt;Seleccionar el certificado en Editar -&amp;gt; Preferencias -&amp;gt; icono Cuentas de correo -&amp;gt; seleccionar la cuenta en uso -&amp;gt; Editar -&amp;gt; Seguridad -&amp;gt; MIME seguro (S/MIME) -&amp;gt; Certificado de firma -&amp;gt; Seleccionar&lt;/p&gt;
&lt;p&gt;Si aparece ya se podrán firmar los mensajes digitalmente con validez legal en el país.&lt;/p&gt;
&lt;p&gt;Se recomienda utilizar un algoritmo de firma SHA256 o superior.&lt;/p&gt;</description><category>Firma digital</category><category>Software libre</category><guid>http://www.jaquerespeis.org/posts/configurar-evolution-correo-electronico-firma-digital/</guid><pubDate>Thu, 30 Jun 2016 10:06:02 GMT</pubDate></item></channel></rss>