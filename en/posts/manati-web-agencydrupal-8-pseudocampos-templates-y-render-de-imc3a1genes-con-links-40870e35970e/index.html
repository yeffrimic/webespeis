<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Drupal 8: Pseudocampos, templates y render de imágenes con links. | JáquerEspeis</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" href="../../../rss.xml">
<link rel="canonical" href="http://www.jaquerespeis.org/en/posts/manati-web-agencydrupal-8-pseudocampos-templates-y-render-de-imc3a1genes-con-links-40870e35970e/">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="JáquerEspeis">
<link rel="prev" href="../manati-web-agencyhttps-medium-com-manati-web-agency-drupal-8-pseudo-fields-templates-and-rendering-images-with-links-8d02d083d2f/" title="Drupal 8: Pseudo fields, templates and rendering images with links." type="text/html">
<link rel="next" href="../michijonesmaperespeis6-ddfd8062b727/" title="#maperespeis6" type="text/html">
<meta property="og:site_name" content="JáquerEspeis">
<meta property="og:title" content="Drupal 8: Pseudocampos, templates y render de imágenes con links.">
<meta property="og:url" content="http://www.jaquerespeis.org/en/posts/manati-web-agencydrupal-8-pseudocampos-templates-y-render-de-imc3a1genes-con-links-40870e35970e/">
<meta property="og:description" content="Ilustración de Lucy SánchezRead this article in english: Drupal 8: Pseudo fields, templates and rendering images with links.Hace unos días atrás inicie el desarrollo de un nuevo sitio en Drupal 8. Est">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-23T16:05:01-06:00">
<meta property="article:tag" content="backend">
<meta property="article:tag" content="drupal-8">
<meta property="article:tag" content="php">
<meta property="article:tag" content="web-development">
<link rel="alternate" hreflang="es" href="../../../posts/manati-web-agencydrupal-8-pseudocampos-templates-y-render-de-imc3a1genes-con-links-40870e35970e/">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://www.jaquerespeis.org/en/">

                <span id="blog-title">JáquerEspeis</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../../archive.html">Archivo</a>
                </li>
<li>
<a href="../../../categories/">Etiquetas</a>
                </li>
<li>
<a href="../../../rss.xml">Canal RSS</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
            </li>
<li><a href="http://www.jaquerespeis.org/" rel="alternate" hreflang="es">Español</a></li>

                
                    
    <li>
    <a href="index.src.html" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post- h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Drupal 8: Pseudocampos, templates y render de imágenes con links.</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    JáquerEspeis
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-05-23T16:05:01-06:00" itemprop="datePublished" title="2017-05-23 16:05">2017-05-23 16:05</time></a></p>
            
        <p class="sourceline"><a href="index.src.html" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <figure><img alt="" src="https://cdn-images-1.medium.com/max/800/1*i9Lxf4RqvuJbLRf426cb0g.png"><figcaption>Ilustración de <a href="https://medium.com/u/685ec9b9459c">Lucy Sánchez</a></figcaption></figure><p><em>Read this article in english:</em> <a href="https://medium.com/p/8d02d083d2f"><strong>Drupal 8: Pseudo fields, templates and rendering images with links</strong></a><strong>.</strong></p>
<p>Hace unos días atrás inicie el desarrollo de un nuevo sitio en Drupal 8. Este sitio ha llegado con una gran cantidad de retos interesantes puesto que muchas de las funcionalidades requeridas aún no son sencillas de implementar. En este momento hay muchos módulos <em>contrib que</em> aun se encuentran en desarrollo, uno de estos módulos es: <a href="https://www.drupal.org/project/group"><em>group</em></a>.</p>
<p>Nuestro cliente requiere que cada usuario autenticado pueda ver los grupos a los que pertenece directamente desde su perfil. Esta funcionalidad tiene que realizase de manera tal que se pudiera ver solamente el logo del grupo, y este logo debe estar enlazado a la página del sitio. Investigué para buscar alternativas con <em>views</em> u otros módulos contrib, pero la investigación no dio muchos frutos.</p>
<p>Opté por el desarrollo de algo <em>custom:</em> elegí desarrollar un pseudocampo para los usuarios. Dicho campo utilizará un <em>template</em> para imprimir dichos grupos.</p>
<h4>Manos a la obra.</h4>
<p>Primero necesitamos crear un pseudocampo. Recordemos que los pseudocampos son elementos que, al igual que un campo, podemos administrar desde la interfaz de despliegue de cada entidad, pero la diferencia radica en que este elemento solo tiene una función: mostrar información, a diferencia de un campo normal que muestra y almacena información brindada por los usuarios.</p>
<p>En drupal 8- como en drupal 7- necesitamos hacer uso de 2 hooks para hacer disponible nuestro pseudocampo para una entidad, estos son: <em>hook_entity_extra_field_info()</em> y<em> hook_[ENTITY NAME]_view().</em></p>
<h4>hook_entity_extra_field_info().</h4>
<p>Indica a la entidad que ahora va a existir un nuevo elemento disponible para su despliegue. Para nuestro caso lo implementamos de la siguiente manera:</p>
<pre>/**<br> * Implements hook_entity_extra_field_info().<br> */<br>function my_module_entity_extra_field_info() {<br>  $extra = [];<br>  $extra['user']['user']['display']['my_mudule_active_subsites'] = array(<br>    'label' =&gt; new TranslatableMarkup('Active subsites'),<br>    'description' =&gt; new TranslatableMarkup('Show the current subscribed sites by one user'),<br>  );<br>  return $extra;<br>}</pre>
<h4>hook_[ENTITY NAME]_view()</h4>
<p>En este caso nos interesa usar <em>hook_user_view() </em>porque que estamos trabajando con la entidad de tipo usuario. <em>hook_[ENTITY NAME]_view() </em>básicamente se encarga de manejar el despliegue de cada uno de los elementos de una entidad dada. En este caso lo vamos a utilizar para dar forma a nuestro pseudocampo <em>my_mudule_active_subsites.</em></p>
<p>Para drupal 8, la implementación de este hook varía un poco en los parámetros que recibe, podemos encontrar más documentación aquí: <a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_view/8.2.x">https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Entity%21entity.api.php/function/hook_entity_view/8.2.x</a></p>
<pre>/**<br> * Implements hook_user_view().<br> */<br>function my_module_view(array &amp;$build, EntityInterface $entity, EntityViewDisplayInterface $display, $view_mode, $langcode) {<br>  if ($view_mode === 'full') {<br>    if ($display-&gt;getComponent('my_module_active_subsites')) {<br>      $groups = my_module_user_current_user_groups($entity);<br>      $groups_to_render = my_module_render_groups_images($groups);<br>      $build['my_module_user_active_subsites'] = [<br>        '#theme' =&gt; 'my_module_active_subsites',<br>        '#groups' =&gt; $groups_to_render,<br>      ];<br>    }<br>  }<br>}</pre>
<p>Como podemos ver en el ejemplo, estamos usando la variable build que nos llega por referencia para asignar a nuestro pseudocampo el valor a mostrar. Nótese que creamos un nuevo índice dentro del arreglo de build que es un arreglo de render. Dentro de nuestro índice usamos #theme para indicar que vamos a hacer uso de un template, el cual definiremos más adelante y también hacemos uso de #groups que es una variable propia de nuestro template.</p>
<p>Ahora, un detalle importante: como se puede apreciar en nuestro ejemplo, se hace uso de 2 funciones para obtener tanto los grupos del usuario como los datos preprocesados listos para ser impresos por drupal. La función <em>my_module_user_current_user_groups() </em>básicamente retorna un arreglo de entidades de tipo group, por lo cual no ahondaremos en ella. Por el contrario, sí entraremos en detalles con <em>my_module_render_groups_images().</em></p>
<h4><em>my_module_render_groups_images()</em></h4>
<p>Esta función nació por la necesidad de que nuestras imágenes estén envueltas en un link, específicamente, un enlace a la entidad de tipo grupo. Lo resolvemos de la siguiente manera:</p>
<pre>/**<br> * Helper function to render the images with a specific image style.<br> *<br> * <a href="http://twitter.com/param">@param</a> array $groups<br> *   The entity groups with the images to render.<br> */<br>function my_module_render_groups_images(array $groups) {<br>  $groups_to_render = [];<br>  foreach ($groups as $group) {<br>    $group_item = new Stdclass();<br>    $image_id = $group-&gt;field_site_logo-&gt;target_id;<br>    if (!empty($image_id)) {<br>      $image_render_array = [<br>        '#theme' =&gt; 'image_style',<br>        '#width' =&gt; $group-&gt;field_site_logo-&gt;width,<br>        '#height' =&gt; $group-&gt;field_site_logo-&gt;height,<br>        '#style_name' =&gt; 'site_logo_user_profile',<br>        '#uri' =&gt; $group-&gt;field_site_logo-&gt;entity-&gt;uri-&gt;value,<br>      ];<br>      $renderer = \Drupal::service('renderer');<br>      $renderer-&gt;addCacheableDependency($image_render_array, $group-&gt;field_site_logo-&gt;entity);<br>      $rendered_image = $renderer-&gt;render($image_render_array);<br>      $link_render_array = [<br>        '#type' =&gt; 'link',<br>        '#url' =&gt; Url::fromUri('entity:group/' . $group-&gt;id()),<br>        '#title' =&gt; $rendered_image,<br>      ];<br>      $group_item-&gt;logo = $link_render_array;<br>    }<br>    $groups_to_render[] = $group_item;<br>  }<br>  return $groups_to_render;<br>}</pre>
<p>Como se puede observar en el ejemplo, lo que realizamos para imprimir nuestra imagen con link, fue: primero preparar un arreglo de render para hacer uso del template de <em>image_style</em>. Luego usamos el servicio <em>renderer </em>de drupal 8 (remplazo de <em>drupal_render</em> en drupal 7) para obtener un objeto de tipo <em>renderer,</em> el cual posteriormente será asignado como valor para el <em>title</em> de nuestro link.</p>
<h4>Definiendo nuestro twig template.</h4>
<p>Al igual que en drupal 7, si queremos hacer uso de nuestro propio template en un módulo, debemos hacer la definición del mismo, osea, hacerle saber a Drupal que este template existe. Para esto hacemos uso del <em>hook_theme().</em></p>
<pre>/**<br> * Implements hook_theme().<br> */<br>function my_module_user_theme($existing, $type, $theme, $path) {<br>  return [<br>    'my_module_user_active_subsites' =&gt; [<br>      'variables' =&gt; [<br>        'groups' =&gt; '',<br>      ],<br>    ],<br>  ];<br>}</pre>
<h4>Creando nuestro template.</h4>
<p>Ahora, como paso final, procederemos a crear nuestro twig template. Para que nuestros templates sean reconocidos debemos colocarlos en una ubicación específica, siguiendo un formato de nombre específico.</p>
<p>Nuestros templates deben estar en una carpeta llamada “templates” en la raíz de nuestro módulo y como mencionamos, deben seguir el siguiente formato de nombre: nombre-template.html.twig. Para nuestro caso creamos el archivo: my-module-active-subsites.html.twig.</p>
<p>Este template se encargará de formatear e imprimir las imágenes pertenecientes a nuestros grupos:</p>
<pre>{#<br>/**<br> * <a href="http://twitter.com/file">@file</a><br> * Template file my_module_active_subsites field<br> */<br>#}</pre>
<pre>&lt;div class="container user-groups-container"&gt;<br>   {% if groups is not empty %}<br>     {% for group in groups %}<br>        &lt;div class="container user-groups-element" &gt;<br>          {{ group.logo }}<br>        &lt;/div&gt;<br>     {% endfor %}<br>   {% endif %}<br>&lt;/div&gt;</pre>
<p>Como podemos observar twig es muy distinto de lo que conocíamos antes en los PHP templates, pero esto no significa que sea complicado. En mi caso me apoyé en esta documentación: <a href="https://www.drupal.org/docs/8/theming/twig/comparison-of-phptemplate-and-twig-theming-paradigms">https://www.drupal.org/docs/8/theming/twig/comparison-of-phptemplate-and-twig-theming-paradigms,</a> esta documentación da una comparación entre lo que antes hacíamos con PHP templates y cómo se hace ahora con twig.</p>
<p>Como pudimos ver, los pseudocampos de Drupal 8 al igual que en Drupal 7, siguen siendo un gran recurso que permite dar flexibilidad a nuestros despliegues de entidades. Si a esto le unimos templates, podemos cumplir con cualquier requerimiento de despliegue de nuestro contenido. Solo se debe recordar que el uso de los mismos depende del tipo del despliegue que queramos usar para nuestro contenido.</p>
<p>¡Feliz codificación!</p>
<p><a href="https://www.estudiomanati.com/"><strong><em>Manatí</em></strong></a><strong><em> es una firma consultora web de origen costarricense</em></strong><em>, donde hacemos sitios estratégicamente diseñados para llevar organizaciones a lograr objetivos.</em></p>
<p><em>No se pierdan los proyectos, noticias e ideas de nosotros en Manatí. Conozca más sobre lo que hacemos, síganos en </em><a href="https://medium.com/manati-web-agency"><strong><em>medium</em></strong></a><em>, </em><a href="https://twitter.com/estudiomanati"><strong><em>twitter</em></strong></a><em> y </em><a href="https://twitter.com/estudiomanati"><strong><em>facebook</em></strong></a><em>.</em></p>
<img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=40870e35970e" width="1" height="1"><hr>
<p><a href="https://medium.com/manati-web-agency/drupal-8-pseudocampos-templates-y-render-de-im%C3%A1genes-con-links-40870e35970e">Drupal 8: Pseudocampos, templates y render de imágenes con links.</a> was originally published in <a href="https://medium.com/manati-web-agency">MANATI | Agencia Web</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/backend/" rel="tag">backend</a></li>
            <li><a class="tag p-category" href="../../categories/drupal-8/" rel="tag">drupal-8</a></li>
            <li><a class="tag p-category" href="../../categories/php/" rel="tag">php</a></li>
            <li><a class="tag p-category" href="../../categories/web-development/" rel="tag">web-development</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../manati-web-agencyhttps-medium-com-manati-web-agency-drupal-8-pseudo-fields-templates-and-rendering-images-with-links-8d02d083d2f/" rel="prev" title="Drupal 8: Pseudo fields, templates and rendering images with links.">Previous post</a>
            </li>
            <li class="next">
                <a href="../michijonesmaperespeis6-ddfd8062b727/" rel="next" title="#maperespeis6">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Licencia Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>Publicado bajo una licencia <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a>. - Creado con <a href="https://getnikola.com" rel="nofollow">Nikola</a>
            
        </footer>
</div>
</div>


            <script src="../../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
